# ADR (Architecture Decision Records)

## ADR-001: Выбор PostgreSQL как основной БД

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Необходимо выбрать БД для хранения каталогов автомобильных фильтров.

**Решение:** Использовать PostgreSQL.

**Обоснование:**
- Поддержка сложных запросов с JOIN
- Надежность и ACID свойства
- Хорошая производительность для аналитических запросов
- Поддержка JSON и полнотекстового поиска
- Интеграция с Railway

**Альтернативы:**
- MongoDB: Не подходит для реляционных данных
- SQLite: Ограничения для production
- MySQL: Менее гибкий для сложных запросов

**Последствия:**
- Необходимость настройки connection pooling
- Требования к индексации для производительности

---

## ADR-002: Использование Express.js для API

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Выбор веб-фреймворка для Node.js API.

**Решение:** Использовать Express.js.

**Обоснование:**
- Простота и минимализм
- Широкая экосистема middleware
- Хорошая производительность
- Простота деплоя на Railway

**Альтернативы:**
- Fastify: Более сложный для MVP
- Koa: Менее популярный
- NestJS: Избыточный для простого API

**Последствия:**
- Необходимость ручной настройки CORS
- Отсутствие встроенной валидации

---

## ADR-003: TypeScript для типизации

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Выбор языка для разработки API.

**Решение:** Использовать TypeScript.

**Обоснование:**
- Статическая типизация для надежности
- Лучшая поддержка IDE
- Упрощение рефакторинга
- Соответствие современным стандартам

**Альтернативы:**
- JavaScript: Отсутствие типизации
- Flow: Менее популярный

**Последствия:**
- Необходимость компиляции
- Дополнительные зависимости

---

## ADR-004: Vanilla HTML/CSS/JS для UI

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Выбор технологии для веб-интерфейса.

**Решение:** Использовать vanilla HTML/CSS/JavaScript.

**Обоснование:**
- Минимальные зависимости
- Быстрая загрузка
- Простота деплоя
- Соответствие принципам MVP

**Альтернативы:**
- React: Избыточный для простого интерфейса
- Vue: Дополнительная сложность
- Angular: Слишком тяжелый

**Последствия:**
- Ручная работа с DOM
- Отсутствие компонентной архитектуры

---

## ADR-005: Railway как платформа деплоя

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Выбор облачной платформы для хостинга.

**Решение:** Использовать Railway.

**Обоснование:**
- Простота деплоя из GitHub
- Встроенная поддержка PostgreSQL
- Автоматическое масштабирование
- Хорошая интеграция с Node.js

**Альтернативы:**
- Heroku: Более дорогой
- AWS: Слишком сложный для MVP
- Vercel: Не подходит для Node.js API

**Последствия:**
- Зависимость от Railway
- Ограничения по ресурсам

---

## ADR-006: Прямые SQL запросы вместо ORM

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Выбор способа работы с базой данных.

**Решение:** Использовать прямые SQL запросы с библиотекой `pg`.

**Обоснование:**
- Минимальные зависимости
- Полный контроль над запросами
- Лучшая производительность
- Простота отладки

**Альтернативы:**
- Prisma: Дополнительная сложность
- TypeORM: Избыточный для простых запросов
- Sequelize: Устаревший

**Последствия:**
- Необходимость ручного написания SQL
- Отсутствие автоматической миграции

---

## ADR-007: Мягкая дизамбигуация

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Обработка случаев с множественными результатами.

**Решение:** Реализовать мягкую дизамбигуацию с подсказками.

**Обоснование:**
- Улучшение пользовательского опыта
- Минимизация количества вопросов
- Интеллектуальная обработка неоднозначности

**Альтернативы:**
- Жесткая дизамбигуация: Плохой UX
- Отсутствие дизамбигуации: Неточные результаты

**Последствия:**
- Усложнение логики поиска
- Необходимость тестирования edge cases

---

## ADR-008: Confidence Score для результатов

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Оценка качества результатов поиска.

**Решение:** Использовать числовую оценку уверенности от 0.50 до 0.99.

**Обоснование:**
- Прозрачность для пользователя
- Возможность ранжирования результатов
- Упрощение принятия решений

**Альтернативы:**
- Бинарная оценка: Слишком простая
- Сложная система весов: Избыточная

**Последствия:**
- Необходимость калибровки алгоритма
- Пользователи должны понимать значения

---

## ADR-009: Единый эндпоинт API

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Архитектура API для MVP.

**Решение:** Использовать один эндпоинт `POST /api/lookup`.

**Обоснование:**
- Простота использования
- Минимальная поверхность атаки
- Легкость тестирования
- Соответствие принципам MVP

**Альтернативы:**
- REST API: Избыточный для простого поиска
- GraphQL: Слишком сложный

**Последствия:**
- Ограниченная гибкость
- Необходимость версионирования в будущем

---

## ADR-010: CSV как формат импорта данных

**Дата:** 2024-01-15  
**Статус:** Принято  
**Контекст:** Формат для импорта данных из PDF каталогов.

**Решение:** Использовать CSV формат.

**Обоснование:**
- Простота обработки
- Широкая поддержка инструментов
- Легкость валидации
- Человекочитаемость

**Альтернативы:**
- JSON: Слишком сложный для ручного ввода
- XML: Избыточный
- Прямой импорт из PDF: Слишком сложный

**Последствия:**
- Необходимость валидации структуры
- Ограничения по типам данных
